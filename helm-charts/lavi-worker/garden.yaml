kind: Module
name: lavi-worker
type: helm
serviceResource:
  kind: Deployment
  name: '{{ include "lavi-worker.fullname" . }}'
  containerModule: lavi-worker-ctr
build:
  dependencies:
    - lavi-worker-ctr
valueFiles:
  - values.yaml
values:
  image:
    repository: ${modules.lavi-worker-ctr.outputs.deployment-image-name}
    tag: ${modules.lavi-worker-ctr.version}
  ingress:
    host: ${var.hostname}
devMode:
  command: ["uvicorn"]
  args: ["--port=80", "--host=0.0.0.0", "--reload", "lavi_worker.routers.main:app"]
  sync:
    - source: lavi_worker
      target: /src/lavi_worker
      exclude:
        - "**/__pycache__"
      mode: one-way-replica
tests:
  - name: integration
    env:
      BASE_URL: "http://lavi-worker"
    command: ["pytest"]
    args: ["-v", "tests/integration"]
    dependencies:
      - lavi-worker
